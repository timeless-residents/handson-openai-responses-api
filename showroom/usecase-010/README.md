# ユースケース 010: 画像入力と説明生成

このユースケースでは、OpenAI Responses APIを使用して画像を分析し、詳細な説明を生成する方法を紹介します。

## 概要

Responses APIでは、テキストだけでなく画像も入力として受け付けることができます。本サンプルでは、さまざまな方法で画像をAPIに送信し、その内容についての説明を生成する手法を示します。これにより：

- 画像の詳細な説明生成
- 画像内のオブジェクトの識別と分析
- 視覚情報に基づく専門的な分析
- 複数言語での画像説明

このサンプルでは、以下の異なる方法で画像分析を行います：

1. **ローカル画像の分析**: ローカルファイルから読み込んだ画像をBase64エンコードして送信
2. **URL画像の分析**: インターネット上の画像URLを直接APIに送信
3. **詳細分析**: 専門的な視点から画像の特徴や用途を深堀り
4. **多言語分析**: 同じ画像に対して複数言語での説明を生成

## 実行方法

1. プロジェクトのルートディレクトリに`.env`ファイルを作成し、OpenAI APIキーを設定します：

```
OPENAI_API_KEY=your_api_key_here
```

2. 必要なパッケージをインストールします：

```bash
pip install -r requirements.txt
```

3. スクリプトを実行します：

```bash
python main.py
```

## 技術的な実装

### 画像の送信方法

OpenAI APIに画像を送信するには、主に2つの方法があります：

1. **Base64エンコード**:
   ```python
   with open("image.jpg", "rb") as image_file:
       base64_image = base64.b64encode(image_file.read()).decode('utf-8')
   ```

2. **URL参照**:
   ```python
   image_url = "https://example.com/image.jpg"
   ```

### マルチモーダルリクエストの構築

APIリクエストでは、テキストと画像を組み合わせた入力を構築します：

```python
content = [
    {"type": "text", "text": "この画像について説明してください"},
    {
        "type": "image_url",
        "image_url": {
            "url": f"data:image/jpeg;base64,{base64_image}"
        }
    }
]

response = client.chat.completions.create(
    model="gpt-4o",
    messages=[{"role": "user", "content": content}]
)
```

### 画像処理のベストプラクティス

より効率的な画像分析のために、以下の処理を実装しています：

- 大きな画像のリサイズ（Pillowライブラリを使用）
- 画像形式の検証
- エラーハンドリング

## 出力例

### 基本的な画像説明

```
この画像は美しい山岳風景を捉えた写真です。山々が湖または川に映り込んでいる様子が見られます。
前景は静かな水面で、その水面に周囲の山々と空が鏡のように反射しています。
背景には雄大な山脈があり、その頂上部分には雪が残っているように見えます。
全体的に青と緑の色調が豊かで、自然の息をのむような美しさを表現しています。
朝や夕方の光が景色を温かく照らしており、穏やかで静寂な雰囲気が伝わってきます。
```

### 専門的な分析

```
1. 画像の種類: この画像は高解像度の風景写真です。

2. 主要な視覚要素とその配置:
   - 中央に穏やかな湖または川の水面
   - 背景に壮大な山脈
   - 水面に映り込む山々と空のリフレクション
   - 前景の岩や植生

3. 色調と全体的な雰囲気:
   - 青系統のクールトーン（水面、空、遠景の山）
   - 緑と茶色の自然な色調（近景の植物や岩）
   - ゴールデンアワーの温かみのある光（日の出または日没時の撮影）
   - 全体的に静謐で雄大な雰囲気

4. 画像から読み取れるストーリーや文脈:
   この画像は手つかずの自然の美しさと壮大さを表現しています。人間の介入がほとんど見られない原生自然の一瞬を切り取ったものであり、自然との調和や永続性を感じさせます。水面の完璧な反射は宇宙の均衡と平和を象徴しているようです。

5. 適している用途や活用方法:
   - 旅行や観光の宣伝素材
   - 自然保護や環境保全キャンペーン
   - 瞑想やウェルネスアプリの背景
   - カレンダーや壁紙
   - 自然をテーマにした出版物の表紙
   - 高級リゾートやエコツーリズムの広告
```

## 応用例

画像分析APIは以下のような用途に適しています：

1. **アクセシビリティ向上**: 視覚障害者向けの画像説明生成
2. **コンテンツ管理**: 大量の画像の自動カタログ化
3. **Eコマース**: 製品画像からの自動説明生成
4. **SNS分析**: ソーシャルメディア投稿の画像分析
5. **教育**: 教材の視覚的要素の説明
6. **多言語コンテンツ**: 画像の多言語での説明生成

## 実装上の注意点

- 画像サイズが大きすぎると処理に時間がかかる場合があります
- APIへの送信前に適切なサイズにリサイズすることを推奨します
- Base64エンコードで送信する場合、データサイズが大きくなるため、必要に応じて圧縮を検討してください
- より詳細な分析が必要な場合は、具体的な質問を含むプロンプトを使用すると効果的です
- モデルへのプロンプトの書き方で、返答の詳細度や焦点を調整できます

## 追加リソース

- [OpenAI Responses APIドキュメント](https://platform.openai.com/docs/api-reference/responses)
- [画像入力の仕様](https://platform.openai.com/docs/api-reference/responses/object#image-input)
- [Pillow (PIL) ドキュメント](https://pillow.readthedocs.io/)