# ユースケース 011: テキストと画像の複合入力

このユースケースでは、OpenAI Responses APIを使用して、テキストと画像を組み合わせた複合入力を処理し、複雑な対話や分析を行う方法を紹介します。

## 概要

Responses APIの画像分析機能は、テキストと組み合わせることでより強力になります。テキストにより文脈や分析の焦点を指定することで、画像理解をより深化させることができます。このサンプルでは、以下のテキストと画像の複合的な利用方法を示します：

- 画像に対するカスタマイズされた分析
- 複数画像の比較と対照
- 会話履歴を維持した連続的なマルチモーダル対話
- 特定の目的や背景情報に基づいた画像解釈

このサンプルでは、以下の4つの異なる例を通じて複合入力の可能性を示します：

1. **視覚的なQ&A**: 画像に関する質問とフォローアップ質問
2. **複数画像の比較分析**: 一度に複数の画像を送信して比較
3. **創造的なライティング**: 画像をインスピレーションにしたコンテンツ生成
4. **文脈のある視覚分析**: 特定の背景情報と目的を持った画像分析

## 実行方法

1. プロジェクトのルートディレクトリに`.env`ファイルを作成し、OpenAI APIキーを設定します：

```
OPENAI_API_KEY=your_api_key_here
```

2. 必要なパッケージをインストールします：

```bash
pip install -r requirements.txt
```

3. スクリプトを実行します：

```bash
python main.py
```

## 技術的な実装

### マルチターンの会話管理

このサンプルでは複数のメッセージを交換する会話履歴を管理します：

```python
# フォローアップ質問のための会話履歴の管理
messages.append({
    "role": "assistant",
    "content": response["output_text"]
})

messages.append({
    "role": "user",
    "content": "この図表から読み取れるビジネスへの影響や推奨事項は何ですか？"
})

# 会話履歴を使った応答の取得
follow_up_response = chat_with_images(client, messages)
```

### 複数画像の送信

1回のリクエストで複数の画像を送信する方法を示します：

```python
# 複数画像を含むメッセージ
messages = [
    {
        "role": "user",
        "content": [
            {"type": "text", "text": "これら2つの画像を比較してください"},
            {"type": "image", "path": image_path1},
            {"type": "image", "path": image_path2}
        ]
    }
]
```

### 文脈を持った画像分析

テキストで詳細な背景情報や目的を提供することで、より焦点を絞った画像分析を実現します：

```python
# 詳細な文脈を含むプロンプト
content = [
    {"type": "text", "text": "私は自然保護団体のマーケティング担当者です。この風景画像を環境保全キャンペーンで使用したいと考えています..."},
    {"type": "image", "path": landscape_path}
]
```

## サンプル例の詳細

### 例1: 視覚的なQ&A

グラフや図表の画像に対して質問を行い、追加の質問で分析を深掘りします。AI は最初の応答の文脈を記憶しており、フォローアップ質問に対してより適切な回答を提供することができます。

**主な特徴**:
- 初期質問とフォローアップ質問の連続
- 画像の文脈を維持した会話
- データ分析と洞察の抽出

### 例2: 複数画像の比較分析

複数の異なる画像を同時に送信し、それらを比較分析します。AIは提示された画像間の類似点、相違点、および補完的な特性を識別します。

**主な特徴**:
- 単一リクエストでの複数画像処理
- 比較分析とコントラストの導出
- 異なる種類の視覚コンテンツの評価

### 例3: 画像をベースにした創造的なライティング

画像をインスピレーションとして使用し、創造的なコンテンツを生成します。初期の生成コンテンツに基づいて、異なる形式やスタイルでのバリエーションを要求できます。

**主な特徴**:
- 視覚的インスピレーションからのコンテンツ生成
- 異なる文学形式への変換要求
- 画像コンテキストを維持した創造的な対話

### 例4: 文脈のある視覚分析

詳細な背景情報や目的を提供して、特定の文脈での画像分析を要求します。これにより、一般的な説明ではなく、目的に合わせた分析や提案を得ることができます。

**主な特徴**:
- 特定の役割や目的に合わせた分析
- 詳細なプロンプトによる分析の焦点付け
- 実用的な提案や応用方法の導出

## 応用例

テキストと画像の複合入力は以下のような用途に適しています：

1. **ドキュメント分析**: スキャンされた文書や図表についての質問応答
2. **視覚的なトラブルシューティング**: 問題のスクリーンショットと症状説明による診断
3. **デザインレビュー**: デザイン案と改善要求を組み合わせたフィードバック
4. **教育支援**: 学生の課題や問題への段階的なガイダンス
5. **商品カタログ作成**: 製品画像と特徴から自動的な商品説明の生成
6. **不動産リスティング**: 物件写真からの詳細な説明と特徴抽出

## 実装上の注意点

- 複数画像を送信する場合、APIリクエストのサイズが大きくなるため、必要に応じて画像をリサイズすることを検討してください
- 会話の文脈を維持するためには、過去のメッセージを適切に保持する必要があります
- 詳細なテキストプロンプトを提供することで、より焦点を絞った画像分析が可能になります
- モデルは画像内のテキストも認識できますが、複雑な表や微細なテキストは明確に指示する必要があります

## 追加リソース

- [OpenAI Chat Completions API ドキュメント](https://platform.openai.com/docs/api-reference/chat)
- [OpenAI マルチモーダル機能ガイド](https://platform.openai.com/docs/guides/vision)
- [効果的なプロンプト設計](https://platform.openai.com/docs/guides/prompt-engineering)